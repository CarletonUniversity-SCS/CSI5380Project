<!DOCTYPE HTML>
<html>
<head>
<title>Online CD Store</title>
<link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
<!-- jQuery (necessary JavaScript plugins) -->
<script type='text/javascript' src="js/jquery-2.1.3.js"></script>
<script type='text/javascript' src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<!-- Custom Theme files -->
<link href="css/style.css" rel='stylesheet' type='text/css' />
<!-- Custom Theme files -->
<!--//theme-style-->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- start menu -->
<link href="css/megamenu.css" rel="stylesheet" type="text/css" media="all" />
<script src="js/menu_jquery.js"></script>
<!-- ajax+jquery --> 
<script>
<!--request-keep seesion and get userinfo-->
$(document).ready(function(){ 
	var address="localhost:8443";
	//maintain session
	var request = $.ajax({  
        url: "https://"+address+"/CSI5380/keepsession.do",  
        type: "POST",  
        async: false,
        dataType: "json",  
        cache: false,  
        success: function (result, textStatus) {
        	while(result!=null){
        	$(".login").remove();
        	var accountinfo="<div class='accountinfo'><span>Welcome back, <a class='fisrtname' style='text-transform: capitalize'>"+result.account.fname+"</a> !</span></div>";
        	$(".log").append(accountinfo);
        	break;
        	}
        },  
        error: function (XMLHttpRequest, textStatus, errorThrown) {
        	alert(errorThrown); }  
    });
	
	
	if ($.cookie('cart')!=null){
		var cj=$.cookie('cart');
		var cjson= jQuery.param({"cjson": cj});
		var request1 = $.ajax({
	        url: "https://"+address+"/CSI5380/cookies.do",  
	        type: "POST",  
	        async: false,
	        data:cjson,
	        dataType: "json",  
	        cache: false,  
	        success: function (result, textStatus) {
	        	$("#simpleCart_total").text("$"+result.totalprice);
	        	$("#simpleCart_quantity").text(result.quantity);
	        	
	        },  
	        error: function (XMLHttpRequest, textStatus, errorThrown) {
	        	alert(errorThrown); }  
	    });
		
		//show the itemList
		itemList=eval(cj);
		for(i=0;i<itemList.length;i++){
			var item="<div class='cart-header'><div id='"+itemList[i].cdid+"' class='close'> </div><div class='cart-sec simpleCart_shelfItem'><div class='cart-item cyc'><img src='"+itemList[i].imgurl+"' class='img-responsive'/></div><div class='cart-item-info'><h3><a>"+itemList[i].title+"</a><span>by "+itemList[i].artist+"</span></h3><h3>Price: CAD$ "+itemList[i].price+"</h3><ul class='qty'><li><p>Qty : </p><input class='quantityinput' name="+itemList[i].cdid+" type='text' placeholder='1' value='"+itemList[i].quantity+"'/></li></ul><div class='delivery'><span>Delivered in 2-3 bussiness days</span><div class='clearfix'></div></div></div><div class='clearfix'></div></div></div>";
			$(".cart-items").append(item);	
		}
		
		//delete removed items in cookies
		$('.close').unbind('click').bind('click',function(){
			
			$(this).parent().fadeOut('slow', function(){
				
				var cdid=$(this).children('.close').attr("id");
				
				var djson=jQuery.param({"cdid": cdid,"cjson": $.cookie('cart')});
				
				 var request2 = $.ajax({  
                     url: "https://"+address+"/CSI5380/deleteCartItems.do",  
                     type: "POST",  
                     async: false,
                     data:djson,
                     dataType: "json",  
                     cache: false,  
                     success: function (result, textStatus) {
                    	 
                    if(result.flag!="last"){
                    		
                    	$.cookie("cart", result.cookies); 
                    	
                      	var cj=$.cookie('cart');
                   		var cjson= jQuery.param({"cjson": cj});
                   		var request3 = $.ajax({
                   	        url: "https://"+address+"/CSI5380/cookies.do",  
                   	        type: "POST",  
                   	        async: false,
                   	        data:cjson,
                   	        dataType: "json",  
                   	        cache: false,  
                   	        success: function (result, textStatus) {
                   	        	$("#simpleCart_total").text("$"+result.totalprice);
                   	        	$("#simpleCart_quantity").text(result.quantity);
                   	        	
                   	        },  
                   	        error: function (XMLHttpRequest, textStatus, errorThrown) {
                   	        	alert(errorThrown); }  
                   	    });
                   		
                   	 var shipid=$("input[name='radio']:checked").attr("id");
 					var pjson= jQuery.param({"cjson":$.cookie('cart'),"shipping":shipid});
 						var request8 = $.ajax({
 					        url: "https://"+address+"/CSI5380/pricedetails.do",  
 					        type: "POST",  
 					        async: false,
 					        data:pjson,
 					        dataType: "json",  
 					        cache: false,  
 					        success: function (result, textStatus) {
 					        	$("#purchase").text(result.purchase);
 					        	$("#tax").text(result.tax);
 					        	$("#subtotal").text(result.subtotal);
 					        	$("#shippingfee").text(result.shippingfee);
 					        	$("#totalfee").text("CAD$ "+result.totalfee);
 					        },  
 					        error: function (XMLHttpRequest, textStatus, errorThrown) {
 					        	alert(errorThrown); }  
 					    });
 						
                    }else{
                    	$.removeCookie('cart');
                    	alert("You Have Nothing In Cart NOW,This Page Will Lead You To Home Page!");
						window.location.href="index.html";
					}
                     },  
                     error: function (XMLHttpRequest, textStatus, errorThrown) {
                     	alert(errorThrown); }  
                 });
				 
				
						
				
					
         });
			
     	
			});
		//modify items quantity in cookies
		$(".quantityinput").bind('click',function(){
			$(this).val("");
			});
		$(".quantityinput").keyup(function(){
			var cdid=$(this).attr("name");
			var quantity=$(this).val();
			if(quantity!=0){
			var mjson=jQuery.param({"cdid": cdid,"cjson": $.cookie('cart'),"quantity":quantity});
			
			 var request4 = $.ajax({  
                 url: "https://"+address+"/CSI5380/changeCartItems.do",  
                 type: "POST",  
                 async: false,
                 data:mjson,
                 dataType: "json",  
                 cache: false,  
                 success: function (result, textStatus) {
                	 $.cookie("cart", result.cookies, { expires: 7 });
                  	var cj=$.cookie('cart');
               		var cjson= jQuery.param({"cjson": cj});
               		var request5 = $.ajax({
               	        url: "https://"+address+"/CSI5380/cookies.do",  
               	        type: "POST",  
               	        async: false,
               	        data:cjson,
               	        dataType: "json",  
               	        cache: false,  
               	        success: function (result, textStatus) {
               	        	$("#simpleCart_total").text("$"+result.totalprice);
               	        	$("#simpleCart_quantity").text(result.quantity);
               	        	
               	        },  
               	        error: function (XMLHttpRequest, textStatus, errorThrown) {
               	        	alert(errorThrown); }  
               	    });
                 },  
                 error: function (XMLHttpRequest, textStatus, errorThrown) {
                 	alert(errorThrown); }  
             });
			 
			 var shipid=$("input[name='radio']:checked").attr("id");
				var pjson= jQuery.param({"cjson":$.cookie('cart'),"shipping":shipid});
					var request8 = $.ajax({
				        url: "https://"+address+"/CSI5380/pricedetails.do",  
				        type: "POST",  
				        async: false,
				        data:pjson,
				        dataType: "json",  
				        cache: false,  
				        success: function (result, textStatus) {
				        	$("#purchase").text(result.purchase);
				        	$("#tax").text(result.tax);
				        	$("#subtotal").text(result.subtotal);
				        	$("#shippingfee").text(result.shippingfee);
				        	$("#totalfee").text("CAD$ "+result.totalfee);
				        },  
				        error: function (XMLHttpRequest, textStatus, errorThrown) {
				        	alert(errorThrown); }  
				    });
				
			}else{
				
				var djson=jQuery.param({"cdid": cdid,"cjson": $.cookie('cart')});
				
				 var request2 = $.ajax({  
                    url: "https://"+address+"/CSI5380/deleteCartItems.do",  
                    type: "POST",  
                    async: false,
                    data:djson,
                    dataType: "json",  
                    cache: false,  
                    success: function (result, textStatus) {
                   	 $.cookie("cart", result.cookies, { expires: 7 });
                     	var cj=$.cookie('cart');
                  		var cjson= jQuery.param({"cjson": cj});
                  		var request3 = $.ajax({
                  	        url: "https://"+address+"/CSI5380/cookies.do",  
                  	        type: "POST",  
                  	        async: false,
                  	        data:cjson,
                  	        dataType: "json",  
                  	        cache: false,  
                  	        success: function (result, textStatus) {
                  	        	$("#simpleCart_total").text("$"+result.totalprice);
                  	        	$("#simpleCart_quantity").text(result.quantity);
                  	        	
                  	        },  
                  	        error: function (XMLHttpRequest, textStatus, errorThrown) {
                  	        	alert(errorThrown); }  
                  	    });
                    },  
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                    	alert(errorThrown); }  
                });
				 
				 $(this).parent().parent().parent().parent().remove();
			}
			
			});
		
	}else{
		$.cookie("cart", "", { expires: 7 });
		$("#simpleCart_total").text("$0.0");
    	$("#simpleCart_quantity").text(0);
		
	}
	//view shopping cart
	$("a[name='checkout']").click(function(){
    	
		if($.cookie('cart')!="" && $.cookie('cart')!=null){
			window.location.href="checkout.html";
		}else{
			alert("You Do Not Have Items In Cart Yet!");
		}
        
	});
	
	 //get Category list
    var request6 = $.ajax({  
        url: "https://"+address+"/CSI5380/queryCategory.do",  
        type: "POST",  
        async: false,
        dataType: "json",  
        cache: false,  
        success: function (result, textStatus) {
          result=eval(result.categoryList);
          var decate="<li class='active grid'><a class='color1' href='index.html'>Home</a></li><li class='grid'><a class='color2 tm'>new arrivals</a></li>";
          $('.megamenu').append(decate);
          for(var i=0; i< result.length; i++) 
          {  
           j=i+1;
          	var category="<li class='grid'><a class='color"+(j+2)+" tm'>"+result[i].catename+"</a></li>";
           $('.megamenu').append(category);
          }
          $(".tm").unbind('click').bind('click',function(){
              var menu=$(this).text();
              if(menu=="new arrivals"){
            	  window.location.href="cdcatalog.html?content=&key=redate&menu=&title=new arrivals";
              }else if(menu=="Home"){
            	  window.location.href="index.html";
              }else{
            	  window.location.href="cdcatalog.html?content=&key=&menu="+escape(menu);
              }

          });
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
        	alert(errorThrown); }  
          
        }); 
	 
    $("#search").click(function(){
        var content=$("#content").val();
        window.location.href="cdcatalog.html?content="+content+"&key=&menu=&title="+content;
});
	 
	//shipping method
	var request7 = $.ajax({  
        url: "https://"+address+"/CSI5380/shipping.do",  
        type: "POST",  
        async: false,
        dataType: "json",  
        cache: false,  
        success: function (result, textStatus) {
        	result=eval(result);
    		for(i=0;i<result.result.length;i++){
    			if(i==0){
    				var method="<label class='radio left'><input type='radio' name='radio' id='"+result.result[i].shipid+"' checked=''><i></i><span>"+result.result[i].method+"</span><span>"+result.result[i].price+"</span></label>";
    			}else{
    				var method="<label class='radio'><input type='radio' id='"+result.result[i].shipid+"' name='radio'><i></i><span>"+result.result[i].method+"</span><span>"+result.result[i].price+"</span></label>";
    			}
    			$(".shipping-details").append(method);	
    		}
    		$(".shipping-details").append("<div class='clearfix'></div>");
    		
    		var shipid=$("input[name='radio']:checked").attr("id");
    		var pjson= jQuery.param({"cjson":$.cookie('cart'),"shipping":shipid});
    			var request8 = $.ajax({
    		        url: "https://"+address+"/CSI5380/pricedetails.do",  
    		        type: "POST",  
    		        async: false,
    		        data:pjson,
    		        dataType: "json",  
    		        cache: false,  
    		        success: function (result, textStatus) {
    		        	$("#purchase").text(result.purchase);
    		        	$("#tax").text(result.tax);
    		        	$("#subtotal").text(result.subtotal);
    		        	$("#shippingfee").text(result.shippingfee);
    		        	$("#totalfee").text("CAD$ "+result.totalfee);
    		        },  
    		        error: function (XMLHttpRequest, textStatus, errorThrown) {
    		        	alert(errorThrown); }  
    		    });
        },  
        error: function (XMLHttpRequest, textStatus, errorThrown) {
        	alert(errorThrown); }  
    });
	//price details
	
	var shipid=$("input[name='radio']:checked").attr("id");
	var pjson= jQuery.param({"cjson":$.cookie('cart'),"shipping":shipid});
		var request8 = $.ajax({
	        url: "https://"+address+"/CSI5380/pricedetails.do",  
	        type: "POST",  
	        async: false,
	        data:pjson,
	        dataType: "json",  
	        cache: false,  
	        success: function (result, textStatus) {
	        	$("#purchase").text(result.purchase);
	        	$("#tax").text(result.tax);
	        	$("#subtotal").text(result.subtotal);
	        	$("#shippingfee").text(result.shippingfee);
	        	$("#totalfee").text("CAD$ "+result.totalfee);
	        },  
	        error: function (XMLHttpRequest, textStatus, errorThrown) {
	        	alert(errorThrown); }  
	    });
		
		$("input[name='radio']").change(function() {
			var shipid=$("input[name='radio']:checked").attr("id");
			var pjson= jQuery.param({"cjson":$.cookie('cart'),"shipping":shipid});
				var request8 = $.ajax({
			        url: "https://"+address+"/CSI5380/pricedetails.do",  
			        type: "POST",  
			        async: false,
			        data:pjson,
			        dataType: "json",  
			        cache: false,  
			        success: function (result, textStatus) {
			        	$("#purchase").text(result.purchase);
			        	$("#tax").text(result.tax);
			        	$("#subtotal").text(result.subtotal);
			        	$("#shippingfee").text(result.shippingfee);
			        	$("#totalfee").text("CAD$ "+result.totalfee);
			        },  
			        error: function (XMLHttpRequest, textStatus, errorThrown) {
			        	alert(errorThrown); }  
			    });
			
		});
	
});	
</script>
</head>
<body>
<!-- header_top -->
<div class="top_bg">
	<div class="container">
		<div class="header_top">
			<div class="top_right">
				<ul>
				<!--link help page,introduction of the site-->
					<li><a href="#">help</a></li>|
				<!--link contact page,introduction of contact information-->
					<li><a href="contact.html">Contact</a></li>|
				<!--link delivery page,delivery informatin--> 
					<li><a href="#">Delivery information</a></li>
				</ul>
			</div>
			<div class="top_left">
				<h2><span></span> Call us : 613 8888 888</h2>
			</div>
				<div class="clearfix"> </div>
		</div>
	</div>
</div>
<!-- header -->
<div class="header_bg">
<div class="container">
	<div class="header">
	<div class="head-t">
		<div class="logo">
			<a href="index.html"><img src="images/logo.png" class="img-responsive" alt=""/> </a>
		</div>
		<!-- start header_right -->
		<div class="header_right">
			<div class="rgt-bottom">
				<div class="log">
					<div class="login" >
					<!-- loginform defaultly hidden,while click "loginButton",it shows.(menu_jquery.js)-->
						<div id="loginContainer"><a href="#" id="loginButton"><span>Login</span></a>
						    <div id="loginBox">                
						                <fieldset id="body">
						                	<fieldset>
						                        <label for="email">Email Address</label>
						                        <input type="text" name="email" id="email">
						                    </fieldset>
						                    <fieldset>
						                        <label for="password">Password</label>
						                        <input type="password" name="password" id="password">
						                    </fieldset>
										    <fieldset>
												<label for="checkbox"><input type="checkbox" id="checkbox"> <i>Remember me</i></label>
											</fieldset>
						                    <input type="submit" id="login" value="Sign in"><label><a href="register.html">Register</a></label></span>
						            	</fieldset>
						            <span><a href="#">Forgot your password?</a></span>
							</div>
						</div>
					</div>
				</div>
				<div class="cart box_1">
					<a name="checkout" class="checka">
						<h3> <span id="simpleCart_total" class="simpleCart_total"></span> (<span id="simpleCart_quantity" class="simpleCart_quantity"></span> items)<img src="images/bag.png" alt=""></h3>
					</a>	
					<div class="clearfix"> </div>
				</div>
				<div class="clearfix"> </div>
			</div>
			<div class="search">
				<form>
					<input type="text" value="" placeholder="search...">
					<input type="submit" value="">
				</form>
			</div>
			<div class="clearfix"> </div>
		</div>
		<div class="clearfix"> </div>
	</div>
		<!-- start header menu -->
	<ul class="megamenu skyblue">
	</ul> 
</div>
</div>
<div class="container">
<div class="check">
	<div class="col-md-3 cart-total">
			 <a class="continue" href="index.html">Continue to basket</a>
			 <div class="shipping-details">
				 <h3>Shipping Method</h3>			 
			 </div>	
			 <div class="price-details">
				 <h3>Price Details</h3>
				 <span>Purchase</span>
				 <span id="purchase" class="total1"></span>
				 <span>Tax</span>
				 <span id="tax" class="total1"></span>
				 <span>Subtotal</span>
				 <span id="subtotal" class="total1"></span>
				 <span>Delivery Charges</span>
				 <span id="shippingfee" class="total1"></span>
				 <div class="clearfix"></div>				 
			 </div>	
			 <ul class="total_price">
			   <li class="last_price"> <h4>TOTAL</h4></li>	
			   <li class="last_price"><span id="totalfee"></span></li>
			   <div class="clearfix"> </div>
			 </ul>
			
			 
			 <div class="clearfix"></div>
			 <a class="order" href="confirmorder.html">Checkout</a>
			</div>
		 <div class="col-md-13 cart-items">
			 <h1>My Shopping Bag</h1>	
		 </div>
		 
		
			<div class="clearfix"> </div>
		</div>	
	 </div>
	 </div>
<div class="foot-top">
	<div class="container">
		<div class="col-md-6 s-c">
			<li>
				<div class="fooll">
					<h5>follow us on</h5>
				</div>
			</li>
			<li>
				<div class="social-ic">
					<ul>
						<li><a href="#"><i class="facebok"> </i></a></li>
						<li><a href="#"><i class="twiter"> </i></a></li>
						<li><a href="#"><i class="goog"> </i></a></li>
						<li><a href="#"><i class="be"> </i></a></li>
						<li><a href="#"><i class="pp"> </i></a></li>
							<div class="clearfix"></div>	
					</ul>
				</div>
			</li>
				<div class="clearfix"> </div>
		</div>
	</div>
</div>
<div class="footer">
	<div class="container">
		<div class="col-md-3 cust">
			<h4>CUSTOMER CARE</h4>
				<li><a href="#">Help Center</a></li>
				<li><a href="#">FAQ</a></li>
				<li><a href="buy.html">How To Buy</a></li>
				<li><a href="#">Delivery</a></li>
		</div>
		<div class="col-md-2 abt">
			<h4>ABOUT US</h4>
				<li><a href="#">Our Stories</a></li>
				<li><a href="contact.html">Contact</a></li>
		</div>
		<div class="col-md-2 myac">
			<h4>MY ACCOUNT</h4>
				<li><a href="register.html">Register</a></li>
				<li><a href="#">My Cart</a></li>
				<li><a href="#">Order History</a></li>
				<li><a href="buy.html">Payment</a></li>
		</div>
		<div class="col-md-5 our-st">
				<h4>OUR STORES</h4>
			<div class="clearfix"> </div>
				<li><i class="add"> </i>1233 Colonel By Drive</li>
				<li><i class="phone"> </i>613-8888888</li>
				<li><a href="mailto:info@example.com"><i class="mail"> </i>info@carleton.com </a></li>
			
		</div>
		<div class="clearfix"> </div>
			<p>Copyrights © 2015 King of Lab. All rights reserved</p>
	</div>
</div>
</body>
</html>